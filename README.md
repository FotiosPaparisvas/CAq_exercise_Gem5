# Computer Architecture 2024 Gem 5 - Exercise

## Μέρος Πρώτο
1. Για το παράδειγμα του Hello World, χρησιμοποιήσαμε το αρχείο **starter_se.py** το οποίο βοηθάει στην διαμόρφωση ενός συστήματος για την εξομοίωση ενός προγράμματος πάνω σε αυτό. Από αυτό το αρχείο και σε συνδυασμό με την εντολή που χρησιμοποιήσαμε 

   > ./build/ARM/gem5.opt -d hello_result configs/example/arm/starter_se.py --cpu="minor" "tests/test-progs/hello/bin/arm/linux/hello"

   και συγκεκριμένα το flag **--cpu="minor"** διαπιστώνουμε ότι ο επεξεργαστής που θα χρησιμοποιηθεί είναι τύπου **minor** ,δηλαδή ένα απλός επεξεργαστής που εκτελεί τις εντολές με την σειρά που εμφανίζονται (_in-order execution_), ενώ υπάρχουν και άλλοι τύποι διαθέσιμοι. Επίσης παρατηρούμε ότι ο επεξεργαστής θα έχει μόνο **1 πυρήνα** και η συχνότητα λειτουργίας ορίζεται στο **1GHZ**, αφού δεν χρησιμοποιούμε τα αντίστοιχα flag. Όσο αναφορά τις **caches**, το αρχείο θέτει μέγεθος γραμμής της ίσο με **64 bytes** και δύο επίπεδα **L1** και **L2**. Καθώς δεν χρησιμοποιούμε κάποια flags σχετικά με την **μνήμη** ορίζονται οι προεπιλεγμένες τιμές, δηλαδή **DDR3 1600 MHz**, **2 κανάλια** και μέγεθος **2 Gb**. Ακόμα, στο αρχείο δημιουργείται ένας δίαυλος επικοινωνίας εκτός τσιπ, συνδέεται με την θύρα του συστήματος για το φόρτωμα του **_kernel_**, ορίζονται τα **όρια** της μνήμης. Επίσης, υπάρχουν συναρτήσεις που διαχειρίζονται τις εντολές που θα "_τρέξουν_" και που διαχειρίζονται την διαμόρφωση της μνήμης. Τέλος το αρχείο αρχικοποιεί την εξομοίωση και την ξεκινάει.

2. Στο τέλος της εξομοίωσης δημιουργείται ένας φάκελος με τα αρχεία που παράγει ο gem5. Τετοια αρχεία είναι το **stats.txt** και τα **config**. Το πρώτο περιέχει όλες τις πληροφορίες σχετικά με την **εξομοίωση** και την **λειτουργία** του συστήματος, όπως κύκλους ρολογιού, προσπελάσεις μνήμεις κτλπ. Τα config αρχεία περιέχουν όλες τις πληροφορίες με την **διαμόρφωση** του συστήματος. Συγκεκριμένα, τα **config.ini** και **config.json** έχουν παρόμοιες πληροφορίες, απλά το 2ο τις αναπαριστά σε μορφή _json_. 
   * Αν παρατηρήσουμε αυτά τα αρχεία μπορούμε να επαληθεύσουμε τα στοιχεία που έιχε το αρχείο διαμόρφωσης **starter_se.py**.
        ### config.ini
        ```ini
        [system]
        cache_line_size=64
        mem_ranges=0:2147483647

        [system.clk_domain]
        type=SrcClockDomain
        clock=1000

        [system.cpu_cluster.cpus]
        type=MinorCPU
        
        [system.cpu_cluster.cpus.icache]
        type=Cache

        [system.cpu_cluster.cpus.dcache]
        type=Cache
        
        [system.cpu_cluster.l2]
        type=Cache
        
        [system.mem_ctrls0]
        type=DRAMCtrl
        range=0:2147483647:0:1048704

        [system.mem_ctrls1]
        type=DRAMCtrl
        range=0:2147483647:1:1048704 
        ```
    * Όπως αναφέρθηκε προηγουμένως το αρχείο **stats.txt** περιέχει πληροφορίες σχετικά με την εξομοίωση:  
     Το **sim_seconds** είναι ο **συνολικός χρόνος που πέρασε στην εξομοίωση** σε δευτερόλεπτα, δηλαδή ο χρόνος που θα έκανε το πρόγραμμα να τρέξει στον επεξεργαστή του εξομοιούμενου συστήματος.  
     Το **sim_insts** είναι ο **συνολικός αριθμός των εντολών** που εκτελέστηκαν κατά τη διάρκεια της εξομοίωσης, δηλαδή οι εντολές εκτελέστηκαν από τον επεξεργαστή του εξομοιούμενου συστήματος.  
     Το **host_inst_rate** είναι ο **ρυθμός εκτέλεσης εντολών** στον υπολογιστή που φιλοξενεί την εξομοίωση, μετρημένος σε εντολές ανά δευτερόλεπτο. Αυτή η μετρική δείχνει την απόδοση της εξομοίωσης σε σχέση με τον πραγματικό χρόνο.
     * TODO: Το συνολικό νούμερο των "_commited_" εντολών ειναι το system.cpu_cluster.cpus.committedOps             5831 ή system.cpu_cluster.cpus.committedInsts           5027 και στην προκειμένη περίπτωση είναι ίδιο με το sim_ops kai sim_insts αντίστοιχα.
     * H **L2 Cache** προσπελάστηκε συνολικά **474** φορές. Αυτό αναφέρεται στο stats.txt ως **system.cpu_cluster.l2.overall_accesses::total**. TODO: Υπολογισμός προσπελάσεων χωρίς άμεση παροχή από τον εξομοιωτή
3. Σύμφωνα με την βιβλιογραφία του Gem5 υπάρχουν δίαφοροι τύποι επεξεργαστών. Συγκεκριμένα για του in-order execution επεξεργαστες:  
    * **SimpleCPU**: Ένα πολύ βασικό λειτουργικό μοντέλο επεξεργαστή για εξομοιώσεις που δεν χρειάζονται μεγάλη λεπτομέρεια. Χωρίζεται σε 3 κλάσεις:

      * **BaseSimpleCPU**:Μια βασική κλάση που δεν μπορεί να λειτουργήσει ανεξάρτητα. Διαχειρίζεται τη βασική αρχιτεκτονική κατάσταση και τις κοινές λειτουργίες για τα SimpleCPU μοντέλα, όπως interrupts, requests, handlers κλπ.

      * **AtomicSimpleCPU**: Χρησιμοποιεί ατομικές προσβάσεις μνήμης και υπολογίζει μέσο χρόνο πρόσβασης στην cache, παρέχοντας έναν γρήγορο και απλό προσομοιωτή που είναι κατάλληλος για λειτουργικές προσομοιώσεις.

      * **TimingSimpleCPU**: Προσθέτει χρονικές καθυστερήσεις για τις προσβάσεις μνήμης, επιτρέποντας μια πιο ρεαλιστική απεικόνιση χωρίς την πολυπλοκότητα μιας λεπτομερούς προσομοίωσης της μνήμης με τις απαραίτητες συναρτήσεις για την διαχείρισή της​.

    * **MinorCPU**: Ένα μοντέλο in-order CPU με πιο λεπτομερή δομή αγωγού (pipeline) σε σχέση με το SimpleCPU. Έχει μια προκαθορισμένη μορφή αγωγού και διαμορφώσιμες δομές δεδομένων και συμπεριφορές.  Περιλαμβάνει τέσσερα βασικά στάδια: Fetch1, Fetch2, Decode και Execute. Υποστηρίζει Branch Prediction. Σχεδιάστηκε για εφαρμογές που απαιτούν μια πιο λεπτομερή μελέτη συγκεκριμένων στοιχείων και συμπεριφορών στο pipeline, καθώς επιτρέπει με τον τρόπο που έχει σχεδιαστεί την προσομοίωση των εντολών σε αυτό. Παρέχει καλή ισορροπία ανάμεσα στην ταχύτητα προσομοίωσης και το επίπεδο λεπτομέρειας.
    * **HighPerformanceIn-orderCPU**: Ένα μοντέλο επεξεργαστή εν σειρά (in-order) σχεδιασμένο για την προσομοίωση σύγχρονων αρχιτεκτονικών Armv8-A. Το HPI δίνει έμφαση στην επίτευξη υψηλής απόδοσης, διατηρώντας έναν απλό αγωγό εκτέλεσης εν σειρά. Περιλαμβάνει χαρακτηριστικά όπως μηχανισμό πρόβλεψης διακλαδώσεων (branch predictor), ιεραρχία μνήμης με υποστήριξη L1 και L2 cache, καθώς και μεταφραστική μνήμη (TLB) για τη βελτίωση της διαχείρισης διευθύνσεων. Ο επεξεργαστής αυτός είναι κατάλληλος για προσομοιώσεις σε System Call Emulation (SE) και Full System (FS) modes, προσφέροντας ένα ρεαλιστικό μοντέλο για μελέτες σύγχρονων επεξεργαστών Arm​

    * **InOrderCPU**: Ένα παλαιότερο μοντέλο που στοχεύει στη γενική προσομοίωση αγωγών εν σειρά με προσαρμόσιμα στάδια και μοντέλα πρόσβασης πόρων. Επιτρέπει στους ερευνητές να σχεδιάζουν και να προσομοιώνουν νέα δομικά στοιχεία αγωγών, καθιστώντας το χρήσιμο για πειραματισμούς, αν και δεν δίνεται τόσο μεγάλη έμφαση στις τελευταίες εκδόσεις του gem5

   



            



